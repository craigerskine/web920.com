{%- import 'components/partials.njk' as el -%}
{%- set pagetitle -%}
{%- if title %}{{ _site.meta.title +' { '+ title +' }' }}{% else %}{{ _site.meta.title or _site.meta.title }} { {{ _site.meta.desc }} }{% endif -%}
{%- endset -%}

<!doctype html>
<html lang="en" class="bg-transparent antialiased" x-data="{ menu: false }">

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>{{ pagetitle }}</title>
    <meta name="description" content="{{ _site.meta.desc }}" />
    <meta name="author" content="{{ _site.meta.author }} - {{ _site.meta.author_url }}" />
    <meta name="generator" content="{{ eleventy.generator }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=overlays-content" />
    <link rel="icon" type="image/x-icon" href="{{ '/' | url }}favicon.ico" />
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link onload="this.onload=null;this.rel='stylesheet'" rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&display=swap" />

    <meta property="og:title" content="{{ pagetitle }}" />
    <meta property="og:description" content="{{ _site.meta.description }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ page.url | url }}" />
    <meta property="og:image" content="{{ '/' | url }}_assets/img/og.png" />

    {% renderblock 'css' %}

    <script>
      // color mode init
      if (localStorage.getItem('color-mode') === 'dark' || (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('color-mode'))) {
        document.documentElement.classList.add('dark');
      }
    </script>

  </head>

  <body class="bg-gray-50 text-gray-700 font-mono !block" style="display: none;" data-instant-intensity="mousedown">

    <div class="min-h-screen flex-(& col) relative">

      <header class="w-full flex-none relative">
        <nav class="mx-auto py-6 px-4 max-w-7xl flex items-center justify-between lg:(px-8)" aria-label="Global">
          <div class="lg:(flex-1)">
            <a href="{{ '/' | url }}" class="w-32 block motion-safe:(hover:(animate-blob))" aria-label="web920">
              {% include "logo.njk" %}
            </a>
          </div>
          <div class="lg:(hidden)">
            <button
              x-ref="menu"
              @click.prevent="menu = !menu"
              :aria-expanded="menu"
              :aria-controls="$id('dropdown')"
              class="-m-2.5 flex items-center justify-center rounded-md p-2.5 text-(2xl gray-700)"
            >
              <span class="sr-only">Open main menu</span>
              <iconify-icon icon="mdi:menu" inline class="iconify"></iconify-icon>
            </button>
            <div
              x-ref="panel"
              x-show="menu"
              x-trap="menu"
              x-anchor.bottom-end="$refs.menu"
              x-transition
              @click.outside="menu = false"
              @keydown.escape.window="menu = false"
              @keydown.down.prevent.stop="$focus.next()"
              @keydown.up.prevent.stop="$focus.prev()"
              :id="$id('dropdown')"
              class="w-full max-w-[14rem] relative z-50"
              style="display: none;"
            >
              <div tabindex="0" class="p-2 bg-gray-200 rounded-lg shadow-lg focus:(outline-none) focus-visible:(outine-none)">
                <menu class="space-y-1">
                  {%- for item in collections.all | eleventyNavigation %}
                  <li>
                    <a href="{{ item.url | url }}" class="px-4 py-2 block rounded-lg motion-safe:(transition) hover:(bg-gray-300)"{% if item.url == page.url or item.url in page.url %} aria-current="page"{% endif %}>
                      {{ item.key }}
                    </a>
                  </li>
                  {%- endfor %}
                </menu>
                <div class="mt-4 px-4">
                  {{ el.mode() }}
                </div>
              </div>
            </div>
          </div>
          <ul class="text-sm leading-6 font-semibold hidden lg:(flex gap-x-12)">
            {%- for item in collections.all | eleventyNavigation %}
            <li>
              <a href="{{ item.url | url }}" class="group text-gray-900 block relative motion-safe:(transition) hover:(text-gray-500)"{% if item.url == page.url or item.url in page.url %} aria-current="page"{% endif %}>
                {{ item.key }}
                <b class="w-full h-[2px] bg-gray-500/30 absolute inset-x-0 -bottom-1 rounded-sm {% if item.url == page.url or item.url in page.url %}-rotate-3{% else %}opacity-0{% endif %} motion-safe:(transition) group-hover:(opacity-100 -rotate-3)" aria-hidden="true"></b>
              </a>
            </li>
            {%- endfor %}
          </ul>
          <div class="hidden lg:(flex-(& 1) items-center justify-end)">
            {{ el.mode() }}
          </div>
        </nav>
      </header>
      <main class="w-full flex-1">
        {{ content | safe }}
      </main>

      {%- macro footer_nav(title='Title',sub='',url='#') %}
      <li class="py-3 leading-tight">
        <a href="{{ url | url }}" class="group motion-safe:(transition) hover:(text-brand-600)">
          {%- if sub %}<small class="pb-1 text-xs block opacity-80">{{ sub }}</small>{%- endif %}
          <strong>{{ title }}</strong>
        </a>
      </li>
      {%- endmacro %}
      <footer class="mt-8 pt-8 w-full bg-white flex-none md:(mt-24 pt-24) dark:(bg-black/30)">
        <div class="mx-auto px-4 max-w-7xl">
          <div class="pb-8 text-center space-y-5 md:(pb-12 text-start flex items-start justify-between gap-5 space-y-0)">
            <div class="flex-none">
              <a href="{{ '/' | url }}" class="group w-32 inline-flex transform motion-safe:(transition hover:(animate-blob))">
                {% include "logo.njk" %}
              </a>
              <p class="mx-auto mt-2 max-w-xs text-(gray-500 sm) text-wrap-balance md:(mx-0 text-base)">{{ home_page.hero.heading }}</p>
              <ul class="py-5 text-2xl flex justify-center gap-8 md:(justify-start)">
                {%- for item in _site.social %}
                <li>
                  <a href="{{ item.url }}" class="group text-gray-500 relative motion-safe:(transition) hover:(text-{{ item.color }}-500 opacity-100)">
                    <span class="w-12 h-12 bg-{{ item.color }}-500/25 absolute top-1/2 left-1/2 opacity-0 rounded-full -translate-x-1/2 -translate-y-1/2 scale-50 motion-safe:(transition) group-hover:(opacity-100 scale-100)" aria-hidden="true"></span>
                    <iconify-icon icon="{{ item.ico }}" inline="false" class="iconify relative"></iconify-icon>
                    <span class="sr-only">{{ item.title }}</span>
                  </a>
                </li>
                {%- endfor %}
              </ul>
            </div>
            <nav class="w-full text-sm flex justify-center gap-10 md:(max-w-xl justify-end gap-32)">
              {%- for cat in _site.footer %}
              <ul>
                <li class="text-start">
                  <b class="pb-1.5 font-black uppercase block opacity-75">{{ cat.title }}</b>
                  <ul class="mx-auto w-[120px] divide-(y gray-500/20) md:(mx-0)">
                    {# sitemap #}
                    {%- if cat.title == 'Sitemap' %}
                      {%- for item in collections.all | eleventyNavigation %}
                      {{ footer_nav(title=item.key,sub=item.title,url=item.url) }}
                      {%- endfor %}
                    {# tech stack #}
                    {%- else %}
                      {%- for item in cat.nav %}
                      {{ footer_nav(title=item.title,sub=item.sub,url=item.url) }}
                      {%- endfor %}
                    {%- endif %}
                  </ul>
                </li>
              </ul>
              {%- endfor %}
            </nav>
          </div>
          <div class="border-(t gray-500/20) py-3 text-(xs pri-500) leading-relaxed flex items-center justify-between md:(py-6)">
            <p>
              &copy;{% year %} {{ _site.meta.title }}
              <span class="block">Season 1: <a href="{{ _site.meta.author_url | url }}" class="text-brand-700 motion-safe:(transition) hover:(text-brand-900)">{{ _site.meta.author }}</a></span>
            </p>
            <p class="text-end">
              Updated:<br />
              <a href="/changes/">
                <time datetime="{{ _utils.date.raw }}">{{ _utils.date.formatted }}</time>
              </a>
            </p>
          </div>
        </div>
      </footer>

    </div>

    {% renderblock 'js' %}

    <script src="{{ '/' | url }}_assets/js/_app.js?v={% bust %}"></script>

  </body>

</html>